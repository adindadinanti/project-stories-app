import{precacheAndRoute}from"workbox-precaching";import{registerRoute}from"workbox-routing";import{CacheableResponsePlugin}from"workbox-cacheable-response";import{NetworkFirst,CacheFirst,StaleWhileRevalidate}from"workbox-strategies";import{BASE_URL}from"../scripts/config";const manifest=self.__WB_MANIFEST;precacheAndRoute(manifest),registerRoute((({url:e})=>"https://fonts.googleapis.com"===e.origin||"https://fonts.gstatic.com"===e.origin),new CacheFirst({cacheName:"google-fonts"})),registerRoute((({url:e})=>"https://cdnjs.cloudflare.com"===e.origin||e.origin.includes("fontawesome")),new CacheFirst({cacheName:"fontawesome"})),registerRoute((({url:e})=>"https://ui-avatars.com"===e.origin),new CacheFirst({cacheName:"avatars-api",plugins:[new CacheableResponsePlugin({statuses:[0,200]})]})),registerRoute((({request:e,url:i})=>new URL(BASE_URL).origin===i.origin&&"image"!==e.destination),new NetworkFirst({cacheName:"story-app-api"})),registerRoute((({request:e,url:i})=>new URL(BASE_URL).origin===i.origin&&"image"===e.destination),new StaleWhileRevalidate({cacheName:"story-app-api-images"})),registerRoute((({url:e})=>e.origin.includes("maptiler")),new CacheFirst({cacheName:"maptiler-api"}));const CACHE_NAME="story-app-v1",ASSETS_TO_CACHE=["/","/index.html","/manifest.json","/images/icons/icon-192x192.png","/images/icons/icon-512x512.png"];self.addEventListener("install",(e=>{e.waitUntil(caches.open(CACHE_NAME).then((e=>e.addAll(ASSETS_TO_CACHE))))})),self.addEventListener("fetch",(e=>{e.respondWith(caches.match(e.request).then((i=>i||fetch(e.request))))})),self.addEventListener("push",(e=>{const i=e.data?e.data.json():{},t=i.title||"Story App Notification",o={body:i.options?.body||"You have a new notification",icon:"/images/icons/icon-192x192.png",badge:"/images/icons/icon-72x72.png"};e.waitUntil(self.registration.showNotification(t,o))})),self.addEventListener("notificationclick",(e=>{e.notification.close(),e.waitUntil(clients.matchAll({type:"window"}).then((e=>e.length>0?e[0].focus():clients.openWindow("/"))))}));